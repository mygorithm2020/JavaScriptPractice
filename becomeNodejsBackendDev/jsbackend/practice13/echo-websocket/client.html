<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <style>
        .message {
            width: 300px;
            color: #fff;
            background-color: purple;
            margin-top: 5px;
            padding: 5px;
        }
    </style>
</head>
<body>
    <textarea id="message" cols="50" rows="5"></textarea>
    <br/>

    <button onclick="sendMessage()">전송</button>
    <button onclick="webSocketClose()">종료</button>
    <div id="messages"></div>


    
</body>

<script>
    const ws = new WebSocket('ws://localhost:3000');

    function sendMessage(){
        ws.send(document.getElementById('message').value);
        //보내고 텍스트 영역 초기화
        
    }

    function webSocketClose() {
        console.log("종료 누름");
        ws.close();
    }

    ws.onopen = function () {
        console.log('클라이언트 접속 완료!');
    };

    // 서버에서 메시지 수신시 발생
    ws.onmessage = function(event) {
        // 엔터키를 br 태그로 변경
        let message = event.data.replace(/(\r\n|\n|\r)/g, "<br />");
        let el = document.createElement('div');
        el.innerHTML = message;
        el.className = 'message';
        document.getElementById('messages').append(el);

    }

    ws.onclose = function(e){
        console.log("종료");
        document.getElementById('messages').append('서버 접속 종료');
    }

</script>
</html>